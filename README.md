# Project Migration Assistant Pro (MCP Server)

這是一個基於 [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) 構建的伺服器，版本為 `5.0.0`。本工具旨在協助開發者進行專案遷移與分析，整合了檔案系統、資料庫操作以及強大的 Excel 邏輯追蹤功能。

## 核心功能

### 1. 檔案系統工具 (File System)
- **安全限制**：所有檔案操作均限制在 `D:\Project\` 目錄下（可透過 `CONFIG` 修改）。
- `list_files`: 列出指定目錄的內容。
- `read_file`: 讀取檔案文字內容。
- `create_file`: 建立新檔案或覆寫現有檔案。
- `apply_diff`: 使用 Search & Replace 模式修改檔案內容。

### 2. 資料庫工具 (MySQL)
- `get_db_schema`: 快速查看指定資料表的結構（欄位與型別）。
- `execute_sql`: 執行 DDL 或 DML 指令（如 `INSERT`, `UPDATE`, `CREATE TABLE` 等）。

### 3. Excel 批次讀取與邏輯分析
- **批次讀取** (`get_excel_values_batch`): 支援範圍讀取（如 `A1:B10`）或指定儲存格列表，節省 Token 消耗。
- **邏輯追蹤** (`trace_excel_logic`): 
    - **追蹤引用 (Precedents)**: 找出目前儲存格的公式參考了哪些來源。
    - **追蹤從屬 (Dependents)**: 進行衝擊分析，查看目前儲存格的變動會影響哪些公式。
- **數值模擬** (`simulate_excel_change`): 在記憶體中模擬修改數值並即時計算結果，不會更動原始檔案。

## 安裝與設定

### 前置作業
- Node.js (建議 v18 以上)
- MySQL 資料庫

### 安裝依賴
```bash
npm install @modelcontextprotocol/sdk mysql2 xlsx hyperformula dotenv
```

### 環境變數設定 (.env)
請在專案根目錄建立 `.env` 檔案並設定以下參數：
```env
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的密碼
DB_NAME=
BASE_PROJECT_PATH=D:\Project\
```

## 使用方式

### 啟動伺服器
本伺服器透過標準輸入輸出 (Stdio) 進行通訊：
```bash
node index.js
```

### 整合至 Claude Desktop
在您的 `claude_desktop_config.json` 中加入以下配置：
```json
{
  "mcpServers": {
    "migration-assistant": {
      "command": "node",
      "args": ["d:/Develop/MCP_NodeServer/index.js"],
      "env": {
        "DB_PASSWORD": "你的密碼"
      }
    }
  }
}
```

## 技術細節

- **HyperFormula 整合**：利用 `hyperformula` 引擎解析 Excel 公式，支援跨工作表的邏輯追蹤。
- **路徑安全檢查**：`resolveSecurePath` 函式確保所有路徑操作不會越權存取基礎目錄以外的檔案。
- **相容性**：使用 `createRequire` 以在 ESM 模組中支援 CommonJS 套件（如 `xlsx`）。

## 注意事項
- Excel 邏輯追蹤預設深度為 3 層，可透過參數調整。
- 執行 SQL 指令時請謹慎操作，建議在測試環境先行驗證。

---
*Generated by Gemini Code Assist*